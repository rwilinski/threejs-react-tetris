(this["webpackJsonpthreejs-react-tetris"]=this["webpackJsonpthreejs-react-tetris"]||[]).push([[0],{45:function(t,e,n){},51:function(t,e,n){"use strict";n.r(e);var r=n(1),c=n.n(r),o=n(36),a=n.n(o),u=(n(45),n(10)),i=n(15),l=n(34),s=n(7),f=n(56),d=10,b=20,h=10,j=100,O=200,p="_active",v="_ghost",m="".concat("https://rwilinski.github.io/threejs-react-tetris","/fonts/Raleway/static/Raleway-ExtraBold.ttf"),x="#262626",k="#a3a3a3",g="#a3a3a3",B="#fff",y={BACKGROUND:"#4a4e4d",TEXT:"#fff"},w=[{id:"I",color:"#ee5253",maxWidth:4,paths:[[[0,1],[1,1],[2,1],[3,1]],[[2,0],[2,1],[2,2],[2,3]],[[0,2],[1,2],[2,2],[3,2]],[[1,0],[1,1],[1,2],[1,3]]]},{id:"O",color:"#2ecc71",maxWidth:2,paths:[[[0,0],[0,1],[1,0],[1,1]]]},{id:"Z",color:"#2e86de",maxWidth:3,paths:[[[0,0],[1,0],[1,1],[2,1]],[[2,0],[1,1],[2,1],[1,2]],[[0,1],[1,1],[1,2],[2,2]],[[1,0],[0,1],[1,1],[0,2]]]},{id:"S",color:"#f1c40f",maxWidth:3,paths:[[[1,0],[2,0],[0,1],[1,1]],[[1,0],[1,1],[2,1],[2,2]],[[1,1],[2,1],[0,2],[1,2]],[[0,0],[0,1],[1,1],[1,2]]]},{id:"J",color:"#9b59b6",maxWidth:3,paths:[[[0,0],[0,1],[1,1],[2,1]],[[1,0],[2,0],[1,1],[1,2]],[[0,1],[1,1],[2,1],[2,2]],[[1,0],[1,1],[0,2],[1,2]]]},{id:"L",color:"#0abde3",maxWidth:3,paths:[[[0,1],[1,1],[2,1],[2,0]],[[1,0],[1,1],[1,2],[2,2]],[[0,1],[1,1],[2,1],[0,2]],[[0,0],[1,0],[1,1],[1,2]]]},{id:"T",color:"#fd79a8",maxWidth:3,paths:[[[1,0],[0,1],[1,1],[2,1]],[[1,0],[1,1],[1,2],[2,1]],[[0,1],[1,1],[2,1],[1,2]],[[1,0],[0,1],[1,1],[1,2]]]}],P=n(9),C={color:k,lineWidth:.5};function A(){return Object(P.jsxs)(P.Fragment,{children:[Array.from(Array(21).keys()).map((function(t){return Object(P.jsx)(f.a,Object(s.a)({points:[[0,t*h,0],[j,t*h,0]]},C),"grid-horizontal-line-".concat(t))})),Array.from(Array(11).keys()).map((function(t){return Object(P.jsx)(f.a,Object(s.a)({points:[[t*h,0,0],[t*h,O,0]]},C),"grid-vertical-line-".concat(t))}))]})}var E=n(41),F=n.n(E),S=n(14),W=n(53);function I(t){return t[Math.floor(Math.random()*t.length)]}function M(t){var e=function(){var t=I(w),e=I(t.paths);return Object(s.a)(Object(s.a)({},t),{},{path:e,defaultPath:e,rotationIndex:t.paths.indexOf(e)})}(),n=Math.floor((t-e.maxWidth)/2),r=e.path.reduce((function(t,e){return e[1]<t?e[1]:t}),1/0);return e.path=e.path.map((function(t){return[t[0]+n,t[1]-r]})),e}function R(t){var e;return null===(e=w.find((function(e){return e.id===t||t.startsWith(e.id)})))||void 0===e?void 0:e.color}function T(t){return String(t).endsWith(p)}function G(t){return String(t).endsWith(v)}function L(t){return T(t)||G(t)}function D(t){var e=t.position,n=void 0===e?[0,0,0]:e,r=t.blockId,c=Object(S.a)(t,["position","blockId"]);return Object(P.jsx)(W.a,Object(s.a)(Object(s.a)({args:[h,h,h],radius:.8,smoothness:1,position:n.map((function(t){return t+5}))},c),{},{children:Object(P.jsx)("meshStandardMaterial",{color:G(r)?B:R(r),roughness:.75,metalness:.5,transparent:!0,opacity:G(r)?.4:1})}))}var X=Object(r.memo)(D,(function(t,e){return t.position[0]===e.position[0]&&t.position[1]===e.position[1]&&t.position[2]===e.position[2]&&t.blockId===e.blockId}));function Y(t){var e=t.block,n=Object(r.useMemo)((function(){return e.defaultPath.reduce((function(t,e){return e[0]<t?e[0]:t}),1/0)}),[e.defaultPath]),c=Object(r.useMemo)((function(){return e.defaultPath.reduce((function(t,e){return e[1]<t?e[1]:t}),1/0)}),[e.defaultPath]),o=Object(r.useMemo)((function(){return(4-function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?0:t.reduce((function(t,e){return e[0]<t?e[0]:t}),1/0);return t.reduce((function(t,e){return e[0]>t?e[0]:t}),0)-e+1}(e.defaultPath))/2}),[e.defaultPath]);return Object(P.jsx)(P.Fragment,{children:Object(P.jsx)("group",{position:[-60,125,0],children:e.defaultPath.map((function(t){return[t[0]-n,t[1]-c]})).map((function(t){return Object(P.jsx)(X,{position:[o*h+t[0]*h,30-t[1]*h,0],blockId:e.id},"block-preview-cell-".concat(t[0],"-").concat(t[1]))}))})})}var N=n(13),q=n(40),z=Object(q.a)((function(t){return{board:[],currentBlock:null,nextBlock:null,score:0,gameOver:!0,gamePaused:!1,restart:function(){return t((function(t){for(var e=[],n=0;n<b;n++){e[n]=[];for(var r=0;r<d;r++)e[n][r]=""}return Object(s.a)(Object(s.a)({},t),{},{board:e,gameOver:!1,score:0,currentBlock:M(d),nextBlock:M(d)})}))},updateBoard:function(){var e=[];return t((function(t){var n,r=t.board.map((function(t){return t.map((function(t){return L(t)?"":t}))}));null===(n=t.currentBlock)||void 0===n||n.path.forEach((function(e){r[e[1]][e[0]]||(r[e[1]][e[0]]=t.currentBlock.id+p)})),t.board.forEach((function(t,n){if(t.filter((function(t){return t&&!L(t)})).length===t.length){e=[].concat(Object(N.a)(e),[n]);for(var c=n;c>0;c--)for(var o=0;o<d;o++)L(r[c][o])||L(r[c-1][o])||(r[c][o]=r[c-1][o])}}));for(var c=[],o=function(e){var n,o=(null===(n=t.currentBlock)||void 0===n?void 0:n.path.map((function(t){return[t[0],t[1]+e]})))||[];if(!o.map((function(t){return r[t[1]]&&null!==r[t[1]][t[0]]?r[t[1]][t[0]]:null})).every((function(t){return""===t||T(t)})))return"break";c=o},a=1;a<b;a++){if("break"===o(a))break}return c.forEach((function(e){r[e[1]][e[0]]||(r[e[1]][e[0]]=t.currentBlock.id+v)})),Object(s.a)(Object(s.a)({},t),{},{board:r,score:t.score+e.length*e.length})})),e},moveDown:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0],t[1]+1]}))})}):t}))},setCurrentBlock:function(e){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{currentBlock:e})}))},prepareForNext:function(){return t((function(t){return t.currentBlock&&t.nextBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)({},t.nextBlock),nextBlock:M(d),board:t.board.map((function(t){return t.map((function(t){return t.replace(p,"")}))}))}):t}))},moveLeft:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0]-1,t[1]]}))})}):t}))},moveRight:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0]+1,t[1]]}))})}):t}))},toggleGamePause:function(){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{gamePaused:!t.gamePaused})}))},setGameOver:function(){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{gameOver:!0})}))}}})),J=n(54);function U(t){var e=t.children,n=Object(S.a)(t,["children"]);return Object(P.jsx)(J.a,Object(s.a)(Object(s.a)({color:g,fontSize:18,font:m,textAlign:"center"},n),{},{children:e}))}var K=Object(r.memo)(U,(function(t,e){return t.children===e.children}));function _(){var t=z((function(t){return{score:t.score,nextBlock:t.nextBlock}}),F.a),e=t.score,n=t.nextBlock;return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(K,{position:[-20,O,0],anchorX:"right",anchorY:"top",children:"NEXT"}),Object(P.jsx)(K,{position:[120,O,0],anchorX:"left",anchorY:"top",children:"SCORE"}),Object(P.jsx)(K,{position:[150,170,0],anchorY:"top",children:e}),n&&Object(P.jsx)(Y,{block:n})]})}var V=n(59),Z=n(55),H=n(57),Q=Object(r.createContext)({}),$=function(t){var e=t.children,n=Object(r.useState)(!1),c=Object(u.a)(n,2),o=c[0],a=c[1],i={shake:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;a(!0),setTimeout((function(){return a(!1)}),t)}};return Object(P.jsxs)(Q.Provider,{value:i,children:[e,Object(P.jsx)(H.a,{maxYaw:o?.02:0,maxPitch:o?.02:0,maxRoll:o?.02:0,yawFrequency:o?10:0,pitchFrequency:o?10:0,rollFrequency:o?10:0})]})},tt=n(58),et=Object(r.createContext)({}),nt=function(t){var e=t.children,n=Object(r.useState)(null),c=Object(u.a)(n,2),o=c[0],a=c[1],i={show:function(t){return a(t)},hide:function(){return a(null)}};return Object(P.jsxs)(et.Provider,{value:i,children:[e,o&&Object(P.jsx)(tt.a,{position:[50,100,50],args:[100,50],"material-color":y.BACKGROUND,follow:!0,children:Object(P.jsx)(J.a,{position:[0,0,1],color:y.TEXT,fontSize:7,maxWidth:90,font:m,anchorX:"center",anchorY:"middle",textAlign:"center",children:o})})]})};function rt(){var t=z(),e=Object(r.useContext)(Q),n=Object(r.useContext)(et),c=Object(r.useState)(null),o=Object(u.a)(c,2),a=o[0],i=o[1],l=function(){var e=t.currentBlock,n=e.path,r=e.defaultPath,c=n[0][0]-r[0][0],o=n[0][1]-r[0][1],a=function(t){var e=t.rotationIndex+1,n=t.paths[e];return n||(e=0,n=t.paths[0]),Object(s.a)(Object(s.a)({},t),{},{path:n,defaultPath:n,rotationIndex:e})}(t.currentBlock);a.path=a.path.map((function(t){return[t[0]+c,t[1]+o]})),a.path.every((function(e){if(e[0]<0||e[0]>=d||e[1]<0||e[1]>=b)return!1;var n=t.board[e[1]][e[0]];return""===n||L(n)}))&&(t.setCurrentBlock(a),t.updateBoard())},f=function(){if(n.hide(),t.gameOver)return i(500),t.restart(),void t.updateBoard();i(t.gamePaused?500:null),t.gamePaused||n.show("Game paused"),t.toggleGamePause()};return Object(V.a)("keydown",(function(e){switch(e.key){case"ArrowUp":a&&l();break;case"ArrowLeft":a&&function(){var e;(null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){var n=t.board[e[1]][e[0]-1];return""===n||L(n)})))&&(t.moveLeft(),t.updateBoard())}();break;case"ArrowRight":a&&function(){var e;(null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){var n=t.board[e[1]][e[0]+1];return""===n||L(n)})))&&(t.moveRight(),t.updateBoard())}();break;case"ArrowDown":a&&i(40);break;case" ":case"Escape":f()}})),Object(V.a)("keyup",(function(t){"ArrowDown"===t.key&&a&&i(500)})),Object(Z.a)((function(){if(function(){var e;return null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){if(e[1]+1>=b)return!1;var n=t.board[e[1]+1][e[0]];return""===n||L(n)}))}())t.moveDown();else{if(!function(){var e;return null===(e=t.nextBlock)||void 0===e?void 0:e.path.every((function(e){return!t.board[e[1]][e[0]]}))}())return t.setGameOver(),i(null),void n.show("GAME OVER\n\nYour score: ".concat(t.score,"\n\nPress space bar to restart."));t.prepareForNext()}t.updateBoard().length&&e.shake()}),a,{immediate:!1}),Object(r.useEffect)((function(){n.show("Press space bar to start")}),[]),Object(P.jsx)(P.Fragment,{children:t.board.map((function(t,e){return t.map((function(t,n){return t?Object(P.jsx)(X,{position:[n*h,190-e*h,0],blockId:t},"cell-".concat(e,"-").concat(n,"-").concat(t)):null}))}))})}var ct=function(){var t=[50,100,150],e=Object(r.useState)(!1),n=Object(u.a)(e,2),c=n[0],o=n[1];return Object(r.useEffect)((function(){Object(l.b)({font:m},(function(){return o(!0)}))}),[]),Object(P.jsx)(i.a,{shadowMap:!0,camera:{fov:75,position:t},onCreated:function(t){return t.gl.setClearColor(x)},children:Object(P.jsx)($,{children:Object(P.jsxs)(nt,{children:[Object(P.jsx)("ambientLight",{intensity:.01}),Object(P.jsx)("pointLight",{position:t,intensity:.9}),c&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(A,{}),Object(P.jsx)(_,{}),Object(P.jsx)(rt,{})]})]})})})},ot=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(e){var n=e.getCLS,r=e.getFID,c=e.getFCP,o=e.getLCP,a=e.getTTFB;n(t),r(t),c(t),o(t),a(t)}))};a.a.render(Object(P.jsx)(c.a.StrictMode,{children:Object(P.jsx)(ct,{})}),document.getElementById("root")),ot()}},[[51,1,2]]]);
//# sourceMappingURL=main.130addef.chunk.js.map