{"version":3,"sources":["game/constants.ts","components/Grid.tsx","game/utils.ts","game/blocks.ts","components/CellRounded.tsx","components/BlockPreview.tsx","game/store.ts","components/RenderText.tsx","components/Hud.tsx","contexts/CameraShakeContext.tsx","contexts/RenderBillboard.tsx","components/Game.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["BOARD_WIDTH","BOARD_HEIGHT","BOX_SIZE","GRID_WIDTH","GRID_HEIGHT","ACTIVE_CELL_SUFFIX","GHOST_CELL_SUFFIX","FONT","process","COLORS","BACKGROUND","TEXT","ALL_BLOCKS","id","color","maxWidth","paths","lineProps","lineWidth","Grid","Array","from","keys","map","index","Line","points","getRandomElement","arr","Math","floor","random","length","getRandomBlockAndCenter","boardWidth","block","randomBlock","randomRotation","path","defaultPath","rotationIndex","indexOf","getRandomBlock","xAxisOffset","yAxisOffset","reduce","prev","curr","Infinity","row","getColorById","find","item","startsWith","isCellActive","cell","String","endsWith","isCellGhost","isCellActiveOrGhost","CellRoundedNoMemo","position","blockId","props","RoundedBox","args","radius","smoothness","p","roughness","metalness","transparent","opacity","CellRounded","memo","next","BlockPreview","useMemo","xCenterOffset","getBlockWidth","useStore","create","set","board","currentBlock","nextBlock","score","gameOver","gamePaused","restart","state","i","j","updateBoard","clearedRows","newBoard","forEach","rowIndex","filter","ghostBlock","ghostBlockPosition","every","moveDown","setCurrentBlock","prepareForNext","replace","moveLeft","moveRight","toggleGamePause","setGameOver","RenderTextNoMemo","children","Text","fontSize","font","textAlign","RenderText","Hud","shallow","anchorX","anchorY","CameraShakeContext","createContext","CameraShakeProvider","useState","isShake","setShake","value","shake","duration","setTimeout","Provider","CameraShake","maxYaw","maxPitch","maxRoll","yawFrequency","pitchFrequency","rollFrequency","RenderBillboardContext","RenderBillboardProvider","text","setText","show","txt","hide","Billboard","material-color","follow","Game","cameraShake","useContext","billboard","gameInterval","setGameInterval","rotate","offsetLeft","offsetTop","newRotationIndex","newPath","rotateBlock","togglePause","useEventListener","key","useInterval","canMoveDown","canAddNewBlock","immediate","useEffect","cellIndex","App","cameraPosition","isFontLoaded","setFontLoaded","preloadFont","shadowMap","camera","fov","onCreated","gl","setClearColor","intensity","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.130addef.chunk.js","sourcesContent":["import { Block } from \"./blocks\";\n\nexport const BOARD_WIDTH = 10;\nexport const BOARD_HEIGHT = 20;\n\nexport const BOX_SIZE = 10;\n\nexport const GRID_WIDTH = BOX_SIZE * BOARD_WIDTH;\nexport const GRID_HEIGHT = BOX_SIZE * BOARD_HEIGHT;\n\nexport const NORMAL_SPEED = 500;\nexport const FAST_SPEED = 40;\n\nexport const ACTIVE_CELL_SUFFIX = \"_active\";\nexport const GHOST_CELL_SUFFIX = \"_ghost\";\n\nexport const FONT = `${process.env.PUBLIC_URL}/fonts/Raleway/static/Raleway-ExtraBold.ttf`;\n\nexport const COLORS = {\n  BACKGROUND: \"#262626\",\n  GRID: \"#a3a3a3\",\n  TEXT: \"#a3a3a3\",\n  GHOST_BLOCK: \"#fff\",\n  BILLBOARD: {\n    BACKGROUND: \"#4a4e4d\",\n    TEXT: \"#fff\",\n  },\n};\n\n// https://strategywiki.org/wiki/Tetris/Rotation_systems\nexport const ALL_BLOCKS: Block[] = [\n  {\n    id: \"I\",\n    color: \"#ee5253\",\n    maxWidth: 4,\n    paths: [\n      [\n        [0, 1],\n        [1, 1],\n        [2, 1],\n        [3, 1],\n      ],\n      [\n        [2, 0],\n        [2, 1],\n        [2, 2],\n        [2, 3],\n      ],\n      [\n        [0, 2],\n        [1, 2],\n        [2, 2],\n        [3, 2],\n      ],\n      [\n        [1, 0],\n        [1, 1],\n        [1, 2],\n        [1, 3],\n      ],\n    ],\n  },\n  {\n    id: \"O\",\n    color: \"#2ecc71\",\n    maxWidth: 2,\n    paths: [\n      [\n        [0, 0],\n        [0, 1],\n        [1, 0],\n        [1, 1],\n      ],\n    ],\n  },\n  {\n    id: \"Z\",\n    color: \"#2e86de\",\n    maxWidth: 3,\n    paths: [\n      [\n        [0, 0],\n        [1, 0],\n        [1, 1],\n        [2, 1],\n      ],\n      [\n        [2, 0],\n        [1, 1],\n        [2, 1],\n        [1, 2],\n      ],\n      [\n        [0, 1],\n        [1, 1],\n        [1, 2],\n        [2, 2],\n      ],\n      [\n        [1, 0],\n        [0, 1],\n        [1, 1],\n        [0, 2],\n      ],\n    ],\n  },\n  {\n    id: \"S\",\n    color: \"#f1c40f\",\n    maxWidth: 3,\n    paths: [\n      [\n        [1, 0],\n        [2, 0],\n        [0, 1],\n        [1, 1],\n      ],\n      [\n        [1, 0],\n        [1, 1],\n        [2, 1],\n        [2, 2],\n      ],\n      [\n        [1, 1],\n        [2, 1],\n        [0, 2],\n        [1, 2],\n      ],\n      [\n        [0, 0],\n        [0, 1],\n        [1, 1],\n        [1, 2],\n      ],\n    ],\n  },\n  {\n    id: \"J\",\n    color: \"#9b59b6\",\n    maxWidth: 3,\n    paths: [\n      [\n        [0, 0],\n        [0, 1],\n        [1, 1],\n        [2, 1],\n      ],\n      [\n        [1, 0],\n        [2, 0],\n        [1, 1],\n        [1, 2],\n      ],\n      [\n        [0, 1],\n        [1, 1],\n        [2, 1],\n        [2, 2],\n      ],\n      [\n        [1, 0],\n        [1, 1],\n        [0, 2],\n        [1, 2],\n      ],\n    ],\n  },\n  {\n    id: \"L\",\n    color: \"#0abde3\",\n    maxWidth: 3,\n    paths: [\n      [\n        [0, 1],\n        [1, 1],\n        [2, 1],\n        [2, 0],\n      ],\n      [\n        [1, 0],\n        [1, 1],\n        [1, 2],\n        [2, 2],\n      ],\n      [\n        [0, 1],\n        [1, 1],\n        [2, 1],\n        [0, 2],\n      ],\n      [\n        [0, 0],\n        [1, 0],\n        [1, 1],\n        [1, 2],\n      ],\n    ],\n  },\n  {\n    id: \"T\",\n    color: \"#fd79a8\",\n    maxWidth: 3,\n    paths: [\n      [\n        [1, 0],\n        [0, 1],\n        [1, 1],\n        [2, 1],\n      ],\n      [\n        [1, 0],\n        [1, 1],\n        [1, 2],\n        [2, 1],\n      ],\n      [\n        [0, 1],\n        [1, 1],\n        [2, 1],\n        [1, 2],\n      ],\n      [\n        [1, 0],\n        [0, 1],\n        [1, 1],\n        [1, 2],\n      ],\n    ],\n  },\n];\n","import { Line } from \"@react-three/drei\";\n\nimport {\n  BOARD_WIDTH,\n  BOARD_HEIGHT,\n  GRID_WIDTH,\n  GRID_HEIGHT,\n  BOX_SIZE,\n  COLORS,\n} from \"../game/constants\";\n\nconst lineProps = {\n  color: COLORS.GRID,\n  lineWidth: 0.5,\n};\n\nexport function Grid() {\n  return (\n    <>\n      {Array.from(Array(BOARD_HEIGHT + 1).keys()).map((index) => (\n        // @ts-ignore\n        <Line\n          key={`grid-horizontal-line-${index}`}\n          points={[\n            [0, index * BOX_SIZE, 0],\n            [GRID_WIDTH, index * BOX_SIZE, 0],\n          ]}\n          {...lineProps}\n        />\n      ))}\n\n      {Array.from(Array(BOARD_WIDTH + 1).keys()).map((index) => (\n        // @ts-ignore\n        <Line\n          key={`grid-vertical-line-${index}`}\n          points={[\n            [index * BOX_SIZE, 0, 0],\n            [index * BOX_SIZE, GRID_HEIGHT, 0],\n          ]}\n          {...lineProps}\n        />\n      ))}\n    </>\n  );\n}\n","export function getRandomElement<T = unknown>(arr: T[]): T {\n  const randomIndex = Math.floor(Math.random() * arr.length);\n\n  return arr[randomIndex];\n}\n","import {\n  ALL_BLOCKS,\n  ACTIVE_CELL_SUFFIX,\n  BOARD_WIDTH,\n  GHOST_CELL_SUFFIX,\n} from \"./constants\";\nimport { getRandomElement } from \"./utils\";\n\nexport type BlockPathDimention = [x: number, y: number];\n\nexport type Block = {\n  id: string;\n  color: string;\n  maxWidth: number;\n  paths: BlockPathDimention[][];\n};\n\nexport type BlockMetadata = Block & {\n  rotationIndex: number;\n  path: BlockPathDimention[];\n  defaultPath: BlockPathDimention[];\n};\n\nexport function getRandomBlock(): BlockMetadata {\n  const randomBlock = getRandomElement(ALL_BLOCKS);\n  const randomRotation = getRandomElement(randomBlock.paths);\n\n  return {\n    ...randomBlock,\n    path: randomRotation,\n    defaultPath: randomRotation,\n    rotationIndex: randomBlock.paths.indexOf(randomRotation),\n  };\n}\n\nexport function getRandomBlockAndCenter(boardWidth: typeof BOARD_WIDTH) {\n  const block = getRandomBlock();\n  const xAxisOffset = Math.floor((boardWidth - block.maxWidth) / 2);\n  const yAxisOffset = block.path.reduce(\n    (prev, curr) => (curr[1] < prev ? curr[1] : prev),\n    Infinity\n  );\n\n  block.path = block.path.map((row) => [\n    row[0] + xAxisOffset,\n    row[1] - yAxisOffset,\n  ]);\n\n  return block;\n}\n\nexport function rotateBlock(block: BlockMetadata) {\n  let newRotationIndex = block.rotationIndex + 1;\n  let newPath = block.paths[newRotationIndex];\n\n  if (!newPath) {\n    newRotationIndex = 0;\n    newPath = block.paths[0];\n  }\n\n  return {\n    ...block,\n    path: newPath,\n    defaultPath: newPath,\n    rotationIndex: newRotationIndex,\n  };\n}\n\nexport function getBlockWidth(path: BlockPathDimention[], absolute = false) {\n  // asbolute - count from 0; include left offset\n  const xAxisOffset = absolute\n    ? 0\n    : path.reduce((prev, curr) => (curr[0] < prev ? curr[0] : prev), Infinity);\n\n  const maxX = path.reduce(\n    (prev, curr) => (curr[0] > prev ? curr[0] : prev),\n    0\n  );\n\n  return maxX - xAxisOffset + 1;\n}\n\nexport function getColorById(id: Block[\"id\"]) {\n  return ALL_BLOCKS.find((item) => item.id === id || id.startsWith(item.id))\n    ?.color;\n}\n\nexport function isCellActive(cell: Block[\"color\"]) {\n  return String(cell).endsWith(ACTIVE_CELL_SUFFIX);\n}\n\nexport function isCellGhost(cell: Block[\"color\"]) {\n  return String(cell).endsWith(GHOST_CELL_SUFFIX);\n}\n\nexport function isCellActiveOrGhost(cell: Block[\"color\"]) {\n  return isCellActive(cell) || isCellGhost(cell);\n}\n","import { memo } from \"react\";\nimport { RoundedBox } from \"@react-three/drei\";\n\nimport { BOX_SIZE, COLORS } from \"../game/constants\";\nimport { Block, getColorById, isCellGhost } from \"../game/blocks\";\n\ntype CellRoundedType = {\n  position: [number, number, number];\n  blockId: Block[\"id\"];\n};\n\nfunction CellRoundedNoMemo({\n  position = [0, 0, 0],\n  blockId,\n  ...props\n}: CellRoundedType) {\n  return (\n    // @ts-ignore\n    <RoundedBox\n      args={[BOX_SIZE, BOX_SIZE, BOX_SIZE]}\n      radius={0.8}\n      smoothness={1}\n      position={position.map((p) => p + BOX_SIZE / 2)}\n      {...props}\n    >\n      <meshStandardMaterial\n        color={\n          isCellGhost(blockId) ? COLORS.GHOST_BLOCK : getColorById(blockId)\n        }\n        roughness={0.75}\n        metalness={0.5}\n        transparent={true}\n        opacity={isCellGhost(blockId) ? 0.4 : 1}\n      />\n    </RoundedBox>\n  );\n}\n\nexport const CellRounded = memo(CellRoundedNoMemo, (prev, next) => {\n  return (\n    prev.position[0] === next.position[0] &&\n    prev.position[1] === next.position[1] &&\n    prev.position[2] === next.position[2] &&\n    prev.blockId === next.blockId\n  );\n});\n","import { useMemo } from \"react\";\n\nimport { CellRounded } from \"./CellRounded\";\nimport { BlockMetadata, getBlockWidth } from \"../game/blocks\";\nimport { BOX_SIZE } from \"../game/constants\";\n\ntype BlockPreviewProps = {\n  block: BlockMetadata;\n};\n\nexport function BlockPreview({ block }: BlockPreviewProps) {\n  // X offset to remove\n  const xAxisOffset = useMemo(\n    () =>\n      block.defaultPath.reduce(\n        (prev, curr) => (curr[0] < prev ? curr[0] : prev),\n        Infinity\n      ),\n    [block.defaultPath]\n  );\n\n  // Y offset to remove\n  const yAxisOffset = useMemo(\n    () =>\n      block.defaultPath.reduce(\n        (prev, curr) => (curr[1] < prev ? curr[1] : prev),\n        Infinity\n      ),\n    [block.defaultPath]\n  );\n\n  // add X offset to center the block on the plane\n  const xCenterOffset = useMemo(() => {\n    const blockWidth = getBlockWidth(block.defaultPath);\n\n    return (4 - blockWidth) / 2;\n  }, [block.defaultPath]);\n\n  return (\n    <>\n      <group position={[-60, 125, 0]}>\n        {block.defaultPath\n          .map((row) => [row[0] - xAxisOffset, row[1] - yAxisOffset])\n          .map((row) => (\n            <CellRounded\n              key={`block-preview-cell-${row[0]}-${row[1]}`}\n              position={[\n                xCenterOffset * BOX_SIZE + row[0] * BOX_SIZE,\n                30 - row[1] * BOX_SIZE,\n                0,\n              ]}\n              blockId={block.id}\n            />\n          ))}\n      </group>\n    </>\n  );\n}\n","import create from \"zustand\";\n\nimport {\n  ACTIVE_CELL_SUFFIX,\n  BOARD_HEIGHT,\n  BOARD_WIDTH,\n  GHOST_CELL_SUFFIX,\n} from \"./constants\";\nimport {\n  BlockMetadata,\n  BlockPathDimention,\n  getRandomBlockAndCenter,\n  isCellActive,\n  isCellActiveOrGhost,\n} from \"./blocks\";\n\ntype Store = {\n  board: string[][];\n  currentBlock: BlockMetadata | null;\n  nextBlock: BlockMetadata | null;\n  score: number;\n  gameOver: boolean;\n  gamePaused: boolean;\n  // Actions:\n  restart: () => void;\n  updateBoard: () => number[];\n  moveDown: () => void;\n  setCurrentBlock: (block: BlockMetadata) => void;\n  prepareForNext: () => void;\n  moveLeft: () => void;\n  moveRight: () => void;\n  toggleGamePause: () => void;\n  setGameOver: () => void;\n};\n\nexport const useStore = create<Store>((set) => ({\n  board: [],\n  currentBlock: null,\n  nextBlock: null,\n  score: 0,\n  gameOver: true,\n  gamePaused: false,\n  // Actions:\n  restart: () =>\n    set((state) => {\n      const board: Store[\"board\"] = [];\n\n      for (let i = 0; i < BOARD_HEIGHT; i++) {\n        board[i] = [];\n\n        for (let j = 0; j < BOARD_WIDTH; j++) {\n          board[i][j] = \"\";\n        }\n      }\n\n      return {\n        ...state,\n        board,\n        gameOver: false,\n        score: 0,\n        currentBlock: getRandomBlockAndCenter(BOARD_WIDTH),\n        nextBlock: getRandomBlockAndCenter(BOARD_WIDTH),\n      };\n    }),\n  updateBoard: () => {\n    let clearedRows: number[] = [];\n\n    set((state) => {\n      // remove old active cells\n      const newBoard = state.board.map((row) =>\n        row.map((cell) => (isCellActiveOrGhost(cell) ? \"\" : cell))\n      );\n\n      // place a new position of block and add active\n      state.currentBlock?.path.forEach((item) => {\n        if (!newBoard[item[1]][item[0]]) {\n          newBoard[item[1]][item[0]] =\n            state.currentBlock!.id + ACTIVE_CELL_SUFFIX;\n        }\n      });\n\n      state.board.forEach((row, rowIndex) => {\n        const isFull =\n          row.filter((cell) => cell && !isCellActiveOrGhost(cell)).length ===\n          row.length;\n\n        if (isFull) {\n          clearedRows = [...clearedRows, rowIndex];\n\n          for (let i = rowIndex; i > 0; i--) {\n            for (let j = 0; j < BOARD_WIDTH; j++) {\n              if (\n                !isCellActiveOrGhost(newBoard[i][j]) &&\n                !isCellActiveOrGhost(newBoard[i - 1][j])\n              ) {\n                newBoard[i][j] = newBoard[i - 1][j];\n              }\n            }\n          }\n        }\n      });\n\n      let ghostBlock: BlockPathDimention[] = [];\n\n      for (let rowIndex = 1; rowIndex < BOARD_HEIGHT; rowIndex++) {\n        const ghostBlockPosition: BlockPathDimention[] =\n          state.currentBlock?.path.map((path) => [\n            path[0],\n            path[1] + rowIndex,\n          ]) || [];\n\n        const canPlaceGhostBlock = ghostBlockPosition\n          .map((cell) => {\n            if (newBoard[cell[1]] && newBoard[cell[1]][cell[0]] !== null) {\n              return newBoard[cell[1]][cell[0]];\n            }\n\n            return null;\n          })\n          .every((cell) => cell === \"\" || isCellActive(cell!));\n\n        if (!canPlaceGhostBlock) {\n          break;\n        }\n\n        ghostBlock = ghostBlockPosition;\n      }\n\n      ghostBlock.forEach((item) => {\n        if (!newBoard[item[1]][item[0]]) {\n          newBoard[item[1]][item[0]] =\n            state.currentBlock!.id + GHOST_CELL_SUFFIX;\n        }\n      });\n\n      return {\n        ...state,\n        board: newBoard,\n        score: state.score + clearedRows.length * clearedRows.length,\n      };\n    });\n\n    return clearedRows;\n  },\n  moveDown: () =>\n    set((state) => {\n      if (!state.currentBlock) {\n        return state;\n      }\n\n      return {\n        ...state,\n        currentBlock: {\n          ...state.currentBlock,\n          path: state.currentBlock.path.map((item) => [item[0], item[1] + 1]),\n        },\n      };\n    }),\n  setCurrentBlock: (block) =>\n    set((state) => ({ ...state, currentBlock: block })),\n  prepareForNext: () =>\n    set((state) => {\n      if (!state.currentBlock || !state.nextBlock) {\n        return state;\n      }\n\n      return {\n        ...state,\n        // swap blocks\n        currentBlock: { ...state.nextBlock },\n        // generate next block\n        nextBlock: getRandomBlockAndCenter(BOARD_WIDTH),\n        // remove active block from board\n        board: state.board.map((row) =>\n          row.map((cell) => cell.replace(ACTIVE_CELL_SUFFIX, \"\"))\n        ),\n      };\n    }),\n  moveLeft: () =>\n    set((state) => {\n      if (!state.currentBlock) {\n        return state;\n      }\n\n      return {\n        ...state,\n        currentBlock: {\n          ...state.currentBlock,\n          path: state.currentBlock.path.map((item) => [item[0] - 1, item[1]]),\n        },\n      };\n    }),\n  moveRight: () =>\n    set((state) => {\n      if (!state.currentBlock) {\n        return state;\n      }\n\n      return {\n        ...state,\n        currentBlock: {\n          ...state.currentBlock,\n          path: state.currentBlock.path.map((item) => [item[0] + 1, item[1]]),\n        },\n      };\n    }),\n  toggleGamePause: () =>\n    set((state) => ({\n      ...state,\n      gamePaused: !state.gamePaused,\n    })),\n  setGameOver: () => set((state) => ({ ...state, gameOver: true })),\n}));\n","import { Text } from \"@react-three/drei\";\nimport { memo } from \"react\";\n\nimport { COLORS, FONT } from \"../game/constants\";\n\nexport function RenderTextNoMemo({ children, ...props }: any) {\n  return (\n    <Text\n      color={COLORS.TEXT}\n      fontSize={18}\n      font={FONT}\n      textAlign=\"center\"\n      {...props}\n    >\n      {children}\n    </Text>\n  );\n}\n\nexport const RenderText = memo(RenderTextNoMemo, (prev, next) => {\n  return prev.children === next.children;\n});\n","import shallow from \"zustand/shallow\";\n\nimport { BlockPreview } from \"./BlockPreview\";\nimport { useStore } from \"../game/store\";\nimport { GRID_WIDTH, GRID_HEIGHT } from \"../game/constants\";\nimport { RenderText } from \"./RenderText\";\n\nexport function Hud() {\n  const { score, nextBlock } = useStore(\n    (state) => ({ score: state.score, nextBlock: state.nextBlock }),\n    shallow\n  );\n\n  return (\n    <>\n      <RenderText\n        position={[-20, GRID_HEIGHT, 0]}\n        anchorX=\"right\"\n        anchorY=\"top\"\n      >\n        NEXT\n      </RenderText>\n\n      <RenderText\n        position={[GRID_WIDTH + 20, GRID_HEIGHT, 0]}\n        anchorX=\"left\"\n        anchorY=\"top\"\n      >\n        SCORE\n      </RenderText>\n\n      <RenderText\n        position={[GRID_WIDTH + 50, GRID_HEIGHT - 30, 0]}\n        anchorY=\"top\"\n      >\n        {score}\n      </RenderText>\n\n      {nextBlock && <BlockPreview block={nextBlock} />}\n    </>\n  );\n}\n","import { createContext, ReactNode, useContext, useState } from \"react\";\nimport { CameraShake } from \"@react-three/drei\";\n\ntype CameraShakeContextType = {\n  shake: (duration?: number) => void;\n};\n\ntype CameraShakeProviderProps = {\n  children: ReactNode;\n};\n\nexport const CameraShakeContext = createContext<CameraShakeContextType>(\n  {} as CameraShakeContextType\n);\n\nexport const CameraShakeProvider = ({ children }: CameraShakeProviderProps) => {\n  const [isShake, setShake] = useState(false);\n\n  const value = {\n    shake: (duration = 200) => {\n      setShake(true);\n      setTimeout(() => setShake(false), duration);\n    },\n  };\n\n  return (\n    <CameraShakeContext.Provider value={value}>\n      {children}\n      <CameraShake\n        maxYaw={isShake ? 0.02 : 0}\n        maxPitch={isShake ? 0.02 : 0}\n        maxRoll={isShake ? 0.02 : 0}\n        yawFrequency={isShake ? 10 : 0}\n        pitchFrequency={isShake ? 10 : 0}\n        rollFrequency={isShake ? 10 : 0}\n      />\n    </CameraShakeContext.Provider>\n  );\n};\n\nexport const useCameraShake = () => {\n  return useContext(CameraShakeContext);\n};\n","import { createContext, ReactNode, useContext, useState } from \"react\";\nimport { Billboard, Text } from \"@react-three/drei\";\nimport { GRID_WIDTH, FONT, COLORS } from \"../game/constants\";\n\ntype RenderBillboardContextType = {\n  show: (text: string) => void;\n  hide: () => void;\n};\n\ntype RenderBillboardProviderProps = {\n  children: ReactNode;\n};\n\nexport const RenderBillboardContext = createContext<RenderBillboardContextType>(\n  {} as RenderBillboardContextType\n);\n\nexport const RenderBillboardProvider = ({\n  children,\n}: RenderBillboardProviderProps) => {\n  const [text, setText] = useState<string | null>(null);\n\n  const value = {\n    show: (txt: string) => setText(txt),\n    hide: () => setText(null),\n  };\n\n  return (\n    <RenderBillboardContext.Provider value={value}>\n      {children}\n      {text && (\n        // @ts-ignore\n        <Billboard\n          position={[GRID_WIDTH / 2, 100, 50]}\n          args={[100, 50]}\n          material-color={COLORS.BILLBOARD.BACKGROUND}\n          follow={true}\n        >\n          {/* @ts-ignore */}\n          <Text\n            position={[0, 0, 1]}\n            color={COLORS.BILLBOARD.TEXT}\n            fontSize={7}\n            maxWidth={90}\n            font={FONT}\n            anchorX=\"center\"\n            anchorY=\"middle\"\n            textAlign=\"center\"\n          >\n            {text}\n          </Text>\n        </Billboard>\n      )}\n    </RenderBillboardContext.Provider>\n  );\n};\n\nexport const useRenderBillboard = () => {\n  return useContext(RenderBillboardContext);\n};\n","import { useEffect, useState } from \"react\";\nimport { useEventListener, useInterval } from \"ahooks\";\n\nimport { CellRounded } from \"./CellRounded\";\nimport { useCameraShake } from \"../contexts/CameraShakeContext\";\nimport { useRenderBillboard } from \"../contexts/RenderBillboard\";\nimport { useStore } from \"../game/store\";\nimport { isCellActiveOrGhost, rotateBlock } from \"../game/blocks\";\nimport {\n  BOARD_HEIGHT,\n  BOARD_WIDTH,\n  BOX_SIZE,\n  FAST_SPEED,\n  NORMAL_SPEED,\n} from \"../game/constants\";\n\nexport function Game() {\n  const state = useStore();\n  const cameraShake = useCameraShake();\n  const billboard = useRenderBillboard();\n  const [gameInterval, setGameInterval] = useState<number | null>(null);\n\n  const startNewGame = () => {\n    setGameInterval(NORMAL_SPEED);\n\n    state.restart();\n    state.updateBoard();\n  };\n\n  const canAddNewBlock = () => {\n    return state.nextBlock?.path.every(\n      (item) => !state.board[item[1]][item[0]]\n    );\n  };\n\n  const canMoveDown = () => {\n    return state.currentBlock?.path.every((item) => {\n      if (item[1] + 1 >= BOARD_HEIGHT) {\n        return false;\n      }\n\n      const cell = state.board[item[1] + 1][item[0]];\n\n      return cell === \"\" || isCellActiveOrGhost(cell);\n    });\n  };\n\n  const rotate = () => {\n    const { path, defaultPath } = state.currentBlock!;\n    const offsetLeft = path[0][0] - defaultPath[0][0];\n    const offsetTop = path[0][1] - defaultPath[0][1];\n\n    const next = rotateBlock(state.currentBlock!);\n\n    next.path = next.path.map((item) => [\n      item[0] + offsetLeft,\n      item[1] + offsetTop,\n    ]);\n\n    const canRotate = next.path.every((item) => {\n      if (\n        item[0] < 0 ||\n        item[0] >= BOARD_WIDTH ||\n        item[1] < 0 ||\n        item[1] >= BOARD_HEIGHT\n      ) {\n        return false;\n      }\n\n      const cell = state.board[item[1]][item[0]];\n\n      return cell === \"\" || isCellActiveOrGhost(cell);\n    });\n\n    if (canRotate) {\n      state.setCurrentBlock(next);\n      state.updateBoard();\n    }\n  };\n\n  const moveLeft = () => {\n    const canMove = state.currentBlock?.path.every((item) => {\n      const cell = state.board[item[1]][item[0] - 1];\n\n      return cell === \"\" || isCellActiveOrGhost(cell);\n    });\n\n    if (canMove) {\n      state.moveLeft();\n      state.updateBoard();\n    }\n  };\n\n  const moveRight = () => {\n    const canMove = state.currentBlock?.path.every((item) => {\n      const cell = state.board[item[1]][item[0] + 1];\n\n      return cell === \"\" || isCellActiveOrGhost(cell);\n    });\n\n    if (canMove) {\n      state.moveRight();\n      state.updateBoard();\n    }\n  };\n\n  const togglePause = () => {\n    billboard.hide();\n\n    if (state.gameOver) {\n      startNewGame();\n\n      return;\n    }\n\n    setGameInterval(state.gamePaused ? NORMAL_SPEED : null);\n\n    // negation, because it's before state change\n    if (!state.gamePaused) {\n      billboard.show(\"Game paused\");\n    }\n\n    state.toggleGamePause();\n  };\n\n  useEventListener(\"keydown\", ({ key }) => {\n    switch (key) {\n      case \"ArrowUp\":\n        if (gameInterval) {\n          rotate();\n        }\n\n        break;\n\n      case \"ArrowLeft\":\n        if (gameInterval) {\n          moveLeft();\n        }\n\n        break;\n\n      case \"ArrowRight\":\n        if (gameInterval) {\n          moveRight();\n        }\n\n        break;\n\n      case \"ArrowDown\":\n        if (gameInterval) {\n          setGameInterval(FAST_SPEED);\n        }\n\n        break;\n\n      case \" \":\n      case \"Escape\":\n        togglePause();\n        break;\n\n      default:\n        break;\n    }\n  });\n\n  useEventListener(\"keyup\", ({ key }) => {\n    if (key === \"ArrowDown\" && gameInterval) {\n      setGameInterval(NORMAL_SPEED);\n    }\n  });\n\n  useInterval(\n    () => {\n      if (!canMoveDown()) {\n        // check can add a new block to the top of the board\n        if (!canAddNewBlock()) {\n          state.setGameOver();\n\n          setGameInterval(null);\n\n          billboard.show(`GAME OVER\n\nYour score: ${state.score}\n\nPress space bar to restart.`);\n\n          return;\n        }\n\n        state.prepareForNext();\n      } else {\n        state.moveDown();\n      }\n\n      const clearedRows = state.updateBoard();\n\n      if (clearedRows.length) {\n        cameraShake.shake();\n      }\n    },\n    gameInterval,\n    { immediate: false }\n  );\n\n  useEffect(() => {\n    billboard.show(\"Press space bar to start\");\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <>\n      {state.board.map((row, rowIndex) => {\n        return row.map((cell, cellIndex) => {\n          if (!cell) {\n            return null;\n          }\n\n          return (\n            <CellRounded\n              key={`cell-${rowIndex}-${cellIndex}-${cell}`}\n              position={[\n                cellIndex * BOX_SIZE,\n                // three.js space starts from the bottom, from 0. Need to reverse\n                (BOARD_HEIGHT - 1) * BOX_SIZE - rowIndex * BOX_SIZE,\n                0,\n              ]}\n              blockId={cell}\n            />\n          );\n        });\n      })}\n    </>\n  );\n}\n","import { useEffect, useState } from \"react\";\nimport { Canvas } from \"react-three-fiber\";\n// @ts-ignore\nimport { preloadFont } from \"troika-three-text\";\n\nimport { Grid } from \"./components/Grid\";\nimport { Hud } from \"./components/Hud\";\nimport { Game } from \"./components/Game\";\nimport { CameraShakeProvider } from \"./contexts/CameraShakeContext\";\nimport { RenderBillboardProvider } from \"./contexts/RenderBillboard\";\nimport { COLORS, FONT, GRID_HEIGHT, GRID_WIDTH } from \"./game/constants\";\n\nfunction App() {\n  const cameraPosition = [GRID_WIDTH / 2, GRID_HEIGHT / 2, 150]; // middle of the grid\n\n  const [isFontLoaded, setFontLoaded] = useState(false);\n\n  useEffect(() => {\n    preloadFont({ font: FONT }, () => setFontLoaded(true));\n  }, []);\n\n  return (\n    <Canvas\n      shadowMap\n      camera={{ fov: 75, position: cameraPosition }}\n      onCreated={({ gl }) => gl.setClearColor(COLORS.BACKGROUND)}\n    >\n      <CameraShakeProvider>\n        <RenderBillboardProvider>\n          <ambientLight intensity={0.01} />\n          <pointLight position={cameraPosition} intensity={0.9} />\n\n          {isFontLoaded && (\n            <>\n              <Grid />\n\n              <Hud />\n\n              <Game />\n            </>\n          )}\n        </RenderBillboardProvider>\n      </CameraShakeProvider>\n    </Canvas>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}