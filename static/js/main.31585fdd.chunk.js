(this["webpackJsonpthreejs-react-tetris"]=this["webpackJsonpthreejs-react-tetris"]||[]).push([[0],{45:function(t,e,n){},51:function(t,e,n){"use strict";n.r(e);var r=n(1),c=n.n(r),o=n(36),a=n.n(o),u=(n(45),n(10)),i=n(15),l=n(34),s=n(7),d=n(56),f=10,b=20,h=10,j=100,O=200,p="_active",v="".concat("https://rwilinski.github.io/threejs-react-tetris","/fonts/Raleway/static/Raleway-ExtraBold.ttf"),m="#eee",x="#787878",k="#191919",g={BACKGROUND:"#4a4e4d",TEXT:"#fff"},B=[{id:"I",color:"#ee5253",maxWidth:4,paths:[[[0,1],[1,1],[2,1],[3,1]],[[2,0],[2,1],[2,2],[2,3]],[[0,2],[1,2],[2,2],[3,2]],[[1,0],[1,1],[1,2],[1,3]]]},{id:"O",color:"#2ecc71",maxWidth:2,paths:[[[0,0],[0,1],[1,0],[1,1]]]},{id:"Z",color:"#2e86de",maxWidth:3,paths:[[[0,0],[1,0],[1,1],[2,1]],[[2,0],[1,1],[2,1],[1,2]],[[0,1],[1,1],[1,2],[2,2]],[[1,0],[0,1],[1,1],[0,2]]]},{id:"S",color:"#f1c40f",maxWidth:3,paths:[[[1,0],[2,0],[0,1],[1,1]],[[1,0],[1,1],[2,1],[2,2]],[[1,1],[2,1],[0,2],[1,2]],[[0,0],[0,1],[1,1],[1,2]]]},{id:"J",color:"#9b59b6",maxWidth:3,paths:[[[0,0],[0,1],[1,1],[2,1]],[[1,0],[2,0],[1,1],[1,2]],[[0,1],[1,1],[2,1],[2,2]],[[1,0],[1,1],[0,2],[1,2]]]},{id:"L",color:"#0abde3",maxWidth:3,paths:[[[0,1],[1,1],[2,1],[2,0]],[[1,0],[1,1],[1,2],[2,2]],[[0,1],[1,1],[2,1],[0,2]],[[0,0],[1,0],[1,1],[1,2]]]},{id:"T",color:"#fd79a8",maxWidth:3,paths:[[[1,0],[0,1],[1,1],[2,1]],[[1,0],[1,1],[1,2],[2,1]],[[0,1],[1,1],[2,1],[1,2]],[[1,0],[0,1],[1,1],[1,2]]]}],w=n(9),y={color:x,lineWidth:.5};function P(){return Object(w.jsxs)(w.Fragment,{children:[Array.from(Array(21).keys()).map((function(t){return Object(w.jsx)(d.a,Object(s.a)({points:[[0,t*h,0],[j,t*h,0]]},y),"grid-horizontal-line-".concat(t))})),Array.from(Array(11).keys()).map((function(t){return Object(w.jsx)(d.a,Object(s.a)({points:[[t*h,0,0],[t*h,O,0]]},y),"grid-vertical-line-".concat(t))}))]})}var C=n(41),A=n.n(C),F=n(14),E=n(53);function I(t){return t[Math.floor(Math.random()*t.length)]}function S(t){var e=function(){var t=I(B),e=I(t.paths);return Object(s.a)(Object(s.a)({},t),{},{path:e,defaultPath:e,rotationIndex:t.paths.indexOf(e)})}(),n=Math.floor((t-e.maxWidth)/2),r=e.path.reduce((function(t,e){return e[1]<t?e[1]:t}),1/0);return e.path=e.path.map((function(t){return[t[0]+n,t[1]-r]})),e}function W(t){var e;return null===(e=B.find((function(e){return e.id===t||t.startsWith(e.id)})))||void 0===e?void 0:e.color}function M(t){return String(t).endsWith(p)}function R(t){var e=t.position,n=void 0===e?[0,0,0]:e,r=t.blockId,c=Object(F.a)(t,["position","blockId"]);return Object(w.jsx)(E.a,Object(s.a)(Object(s.a)({args:[h,h,h],radius:.8,smoothness:1,position:n.map((function(t){return t+5}))},c),{},{children:Object(w.jsx)("meshStandardMaterial",{color:W(r),roughness:.75,metalness:.5})}))}var T=Object(r.memo)(R,(function(t,e){return t.position[0]===e.position[0]&&t.position[1]===e.position[1]&&t.position[2]===e.position[2]&&t.blockId===e.blockId}));function G(t){var e=t.block,n=Object(r.useMemo)((function(){return e.defaultPath.reduce((function(t,e){return e[0]<t?e[0]:t}),1/0)}),[e.defaultPath]),c=Object(r.useMemo)((function(){return e.defaultPath.reduce((function(t,e){return e[1]<t?e[1]:t}),1/0)}),[e.defaultPath]),o=Object(r.useMemo)((function(){return(4-function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?0:t.reduce((function(t,e){return e[0]<t?e[0]:t}),1/0);return t.reduce((function(t,e){return e[0]>t?e[0]:t}),0)-e+1}(e.defaultPath))/2}),[e.defaultPath]);return Object(w.jsx)(w.Fragment,{children:Object(w.jsx)("group",{position:[-60,125,0],children:e.defaultPath.map((function(t){return[t[0]-n,t[1]-c]})).map((function(t){return Object(w.jsx)(T,{position:[o*h+t[0]*h,30-t[1]*h,0],blockId:e.id},"block-preview-cell-".concat(t[0],"-").concat(t[1]))}))})})}var L=n(13),D=n(40),X=Object(D.a)((function(t){return{board:[],currentBlock:null,nextBlock:null,score:0,gameOver:!0,gamePaused:!1,restart:function(){return t((function(t){for(var e=[],n=0;n<b;n++){e[n]=[];for(var r=0;r<f;r++)e[n][r]=""}return Object(s.a)(Object(s.a)({},t),{},{board:e,gameOver:!1,score:0,currentBlock:S(f),nextBlock:S(f)})}))},updateBoard:function(){var e=[];return t((function(t){var n,r=t.board.map((function(t){return t.map((function(t){return M(t)?"":t}))}));return null===(n=t.currentBlock)||void 0===n||n.path.forEach((function(e){r[e[1]][e[0]]||(r[e[1]][e[0]]=t.currentBlock.id+p)})),t.board.forEach((function(t,n){if(t.filter((function(t){return t&&!M(t)})).length===t.length){e=[].concat(Object(L.a)(e),[n]);for(var c=n;c>0;c--)for(var o=0;o<f;o++)M(r[c][o])||M(r[c-1][o])||(r[c][o]=r[c-1][o])}})),Object(s.a)(Object(s.a)({},t),{},{board:r,score:t.score+e.length*e.length})})),e},moveDown:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0],t[1]+1]}))})}):t}))},setCurrentBlock:function(e){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{currentBlock:e})}))},prepareForNext:function(){return t((function(t){return t.currentBlock&&t.nextBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)({},t.nextBlock),nextBlock:S(f),board:t.board.map((function(t){return t.map((function(t){return t.replace(p,"")}))}))}):t}))},moveLeft:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0]-1,t[1]]}))})}):t}))},moveRight:function(){return t((function(t){return t.currentBlock?Object(s.a)(Object(s.a)({},t),{},{currentBlock:Object(s.a)(Object(s.a)({},t.currentBlock),{},{path:t.currentBlock.path.map((function(t){return[t[0]+1,t[1]]}))})}):t}))},toggleGamePause:function(){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{gamePaused:!t.gamePaused})}))},setGameOver:function(){return t((function(t){return Object(s.a)(Object(s.a)({},t),{},{gameOver:!0})}))}}})),Y=n(54);function N(t){var e=t.children,n=Object(F.a)(t,["children"]);return Object(w.jsx)(Y.a,Object(s.a)(Object(s.a)({color:k,fontSize:18,font:v,textAlign:"center"},n),{},{children:e}))}var q=Object(r.memo)(N,(function(t,e){return t.children===e.children}));function z(){var t=X((function(t){return{score:t.score,nextBlock:t.nextBlock}}),A.a),e=t.score,n=t.nextBlock;return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(q,{position:[-20,O,0],anchorX:"right",anchorY:"top",children:"NEXT"}),Object(w.jsx)(q,{position:[120,O,0],anchorX:"left",anchorY:"top",children:"SCORE"}),Object(w.jsx)(q,{position:[150,170,0],anchorY:"top",children:e}),n&&Object(w.jsx)(G,{block:n})]})}var J=n(59),U=n(55),K=n(57),V=Object(r.createContext)({}),Z=function(t){var e=t.children,n=Object(r.useState)(!1),c=Object(u.a)(n,2),o=c[0],a=c[1],i={shake:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;a(!0),setTimeout((function(){return a(!1)}),t)}};return Object(w.jsxs)(V.Provider,{value:i,children:[e,Object(w.jsx)(K.a,{maxYaw:o?.02:0,maxPitch:o?.02:0,maxRoll:o?.02:0,yawFrequency:o?10:0,pitchFrequency:o?10:0,rollFrequency:o?10:0})]})},_=n(58),H=Object(r.createContext)({}),Q=function(t){var e=t.children,n=Object(r.useState)(null),c=Object(u.a)(n,2),o=c[0],a=c[1],i={show:function(t){return a(t)},hide:function(){return a(null)}};return Object(w.jsxs)(H.Provider,{value:i,children:[e,o&&Object(w.jsx)(_.a,{position:[50,100,50],args:[100,50],"material-color":g.BACKGROUND,follow:!0,children:Object(w.jsx)(Y.a,{position:[0,0,1],color:g.TEXT,fontSize:7,maxWidth:90,font:v,anchorX:"center",anchorY:"middle",textAlign:"center",children:o})})]})};function $(){var t=X(),e=Object(r.useContext)(V),n=Object(r.useContext)(H),c=Object(r.useState)(null),o=Object(u.a)(c,2),a=o[0],i=o[1],l=function(){var e=t.currentBlock,n=e.path,r=e.defaultPath,c=n[0][0]-r[0][0],o=n[0][1]-r[0][1],a=function(t){var e=t.rotationIndex+1,n=t.paths[e];return n||(e=0,n=t.paths[0]),Object(s.a)(Object(s.a)({},t),{},{path:n,defaultPath:n,rotationIndex:e})}(t.currentBlock);a.path=a.path.map((function(t){return[t[0]+c,t[1]+o]})),a.path.every((function(e){if(e[0]<0||e[0]>=f||e[1]<0||e[1]>=b)return!1;var n=t.board[e[1]][e[0]];return""===n||M(n)}))&&(t.setCurrentBlock(a),t.updateBoard())},d=function(){if(n.hide(),t.gameOver)return i(500),t.restart(),void t.updateBoard();i(t.gamePaused?500:null),t.gamePaused||n.show("Game paused"),t.toggleGamePause()};return Object(J.a)("keydown",(function(e){switch(e.key){case"ArrowUp":a&&l();break;case"ArrowLeft":a&&function(){var e;(null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){var n=t.board[e[1]][e[0]-1];return""===n||M(n)})))&&(t.moveLeft(),t.updateBoard())}();break;case"ArrowRight":a&&function(){var e;(null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){var n=t.board[e[1]][e[0]+1];return""===n||M(n)})))&&(t.moveRight(),t.updateBoard())}();break;case"ArrowDown":a&&i(40);break;case" ":case"Escape":d()}})),Object(J.a)("keyup",(function(t){"ArrowDown"===t.key&&a&&i(500)})),Object(U.a)((function(){if(function(){var e;return null===(e=t.currentBlock)||void 0===e?void 0:e.path.every((function(e){if(e[1]+1>=b)return!1;var n=t.board[e[1]+1][e[0]];return""===n||M(n)}))}())t.moveDown();else{if(!function(){var e;return null===(e=t.nextBlock)||void 0===e?void 0:e.path.every((function(e){return!t.board[e[1]][e[0]]}))}())return t.setGameOver(),i(null),void n.show("GAME OVER\n\nYour score: ".concat(t.score,"\n\nPress space bar to restart."));t.prepareForNext()}t.updateBoard().length&&e.shake()}),a,{immediate:!1}),Object(r.useEffect)((function(){n.show("Press space bar to start")}),[]),Object(w.jsx)(w.Fragment,{children:t.board.map((function(t,e){return t.map((function(t,n){return t?Object(w.jsx)(T,{position:[n*h,190-e*h,0],blockId:t},"cell-".concat(e,"-").concat(n,"-").concat(t)):null}))}))})}var tt=function(){var t=[50,100,150],e=Object(r.useState)(!1),n=Object(u.a)(e,2),c=n[0],o=n[1];return Object(r.useEffect)((function(){Object(l.b)({font:v},(function(){return o(!0)}))}),[]),Object(w.jsx)(i.a,{shadowMap:!0,camera:{fov:75,position:t},onCreated:function(t){return t.gl.setClearColor(m)},children:Object(w.jsx)(Z,{children:Object(w.jsxs)(Q,{children:[Object(w.jsx)("ambientLight",{intensity:.4}),Object(w.jsx)("pointLight",{position:t,intensity:1}),c&&Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(P,{}),Object(w.jsx)(z,{}),Object(w.jsx)($,{})]})]})})})},et=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(e){var n=e.getCLS,r=e.getFID,c=e.getFCP,o=e.getLCP,a=e.getTTFB;n(t),r(t),c(t),o(t),a(t)}))};a.a.render(Object(w.jsx)(c.a.StrictMode,{children:Object(w.jsx)(tt,{})}),document.getElementById("root")),et()}},[[51,1,2]]]);
//# sourceMappingURL=main.31585fdd.chunk.js.map